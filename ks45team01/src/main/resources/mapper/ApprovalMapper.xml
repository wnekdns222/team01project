<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper	namespace="ks45team01.unity.mapper.ApprovalMapper">
	<resultMap type="Approval" id="approvalResultMap">
		<id property="draftDocNum" 				column="draft_doc_num"/>
		<result property="approvalCategoryNum" 	column="approval_category_num"/>
		<result property="draftTitle" 			column="draft_title"/>
		<result property="registrantNum" 		column="registrant_num"/>
		<result property="reportDate" 			column="report_date"/>
		<result property="draftContents" 		column="draft_contents"/>
		<result property="draftAddfile" 		column="draft_addfile"/>
		<result property="draftAddfilePath" 	column="draft_addfile_path"/>
		<result property="draftDeadline" 		column="draft_deadline"/>
		<result property="draftRegDate" 		column="draft_reg_date"/>
		<result property="approvalFinalState" 	column="approval_final_state"/>
		<association property="approvalProcess" javaType="ApprovalProcess">
			<id property="approvalProcessNum" 		column="approval_process_num"/>
			<result property="approvalLineNum" 		column="approval_line_num"/>
			<result property="draftDocNum" 			column="draft_doc_num"/>
			<result property="processStatus" 		column="process_status"/>
			<result property="rejectReasonMember"	column="reject_reason_member"/>
			<result property="rejectReason" 		column="reject_reason"/>
			<result property="rejectDate" 			column="reject_date"/>
			<result property="approvalDoneDate" 	column="approval_done_date"/>
		</association>
	</resultMap>
	
	<select id="approvalList" resultMap="approvalResultMap" resultType="list">
		/* 결재 진행 목록 조회 */
		SELECT 
			*
		FROM 
			tb_draft_document
		WHERE approval_final_state = '결재진행중';	
	</select>
	
	<select id="draftView" parameterType="String" resultMap="approvalResultMap">
		/* 개별 기안문서 상세보기 */
		SELECT 
			*
		FROM 
			tb_draft_document AS d
			INNER JOIN 
			tb_approval_process AS ap
			ON 
			d.draft_doc_num = ap.draft_doc_num
		WHERE d.draft_doc_num = #{draftDocNum};
	</select>
	
	<select id="draftList" resultMap="approvalResultMap" resultType="list">
		/* 기안문서 목록 조회 */
		SELECT 
			*
		FROM 
			tb_draft_document;
	</select>
</mapper>