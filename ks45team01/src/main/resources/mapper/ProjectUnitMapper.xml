<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ks45team01.unity.mapper.ProjectListMapper">
	<resultMap type="projectUnit" id="projectUnitResultMap">
		<id		property="projectUnitNum"	column="project_unit_num" />
		<result property="projectNum"  column="project_num" />
		<result property="unitContents"  column="unit_contents" />
		<result property="memberInsertNum"  column="member_insert_num" />
		<result property="projectUnitRegDate"  column="project_unit_reg_date" />
		<result property="memberUpdateNum"  column="member_update_num" />
		<result property="projectUnitUpdateDate"  column="project_unit_update_date" />
	</resultMap>
	
	<select id="projectUnitList" resultMap="projectUnitResultMap" parameterType="String">
	SELECT
		*
		FROM
		tb_project_unit AS pu
		WHERE 
		pu.project_num = #{projectNum}
	</select>

	<select id="projectUnitCode" parameterType="String" resultType="String">
	/* 자동증가코드 */
		SELECT
			CASE
			WHEN COUNT(1) = 0 THEN CONCAT('project_unit', '_1')
			ELSE
				CONCAT('project_unit','_', MAX(CAST(SUBSTRING_INDEX(${column}, CONCAT('project_unit', '_'), -1) AS UNSIGNED))+1)
			END AS newCode
		FROM
			${table} ;
	</select>
	
	<insert id="ProjectUnitInsert" parameterType="projectUnit">
	INSERT INTO
	 tb_project_unit
	(project_unit_num, project_num, unit_contents, member_insert_num, project_unit_reg_date)
	VALUES (#{projectUnitNum}, #{projectNum}, #{unitContents}, #{memberInsertNum}, NOW())
	</insert>
	
	
</mapper>